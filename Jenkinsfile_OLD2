pipeline {
    agent any 

    environment {
        APP_NAME    = "tarefapos"
        IMAGE_NAME  = "marcosousaojr/${env.APP_NAME}"
        BRANCH_NAME = GIT_BRANCH.replaceFirst(/^origin\//, '')
    }

    stages {
        stage('Clone Repository') {
            steps {
                // Clonar o repositório onde está sua aplicação
                git 'https://github.com/marcosousaojr/TarefaArvore.git'
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    // Construir a imagem Docker
                    sh 'docker build -t $APP_NAME:$BRANCH_NAME-$BUILD_NUMBER . --no-cache'
                }
            }
        }

        stage('Run Docker Container') {
            steps {
                script {
                    // Executar o contêiner
                    sh 'docker run --rm tarefaArvore'
                }
            }
        }
    }

    post {
        success {
            echo "Pipeline concluído com sucesso!"
        }
        failure {
            echo "Pipeline falhou!"
        }        
    }
}